function สร้างระบบจัดการโรงแรมครบวงจร() {
  const ss = SpreadsheetApp.create('ระบบจัดการโรงแรมเต็มรูปแบบ');
  
  function สร้างชีต(ชื่อ, หัวตาราง) {
    const sheet = ss.insertSheet(ชื่อ);
    sheet.getRange(1, 1, 1, หัวตาราง.length).setValues([หัวตาราง]);
    sheet.setFrozenRows(1);
    sheet.getRange(1,1,1,หัวตาราง.length)
      .setFontWeight('bold')
      .setBackground('#E3F2FD');
    return sheet;
  }

  // ๑. ข้อมูลส่วนบุคคล
  สร้างชีต('ข้อมูลลูกค้า', ['รหัสลูกค้า','ชื่อ-นามสกุล','เลขบัตรประชาชน','เบอร์โทร','อีเมล','ที่อยู่','ประเภทลูกค้า','วันที่สมัคร','สถานะ','หมายเหตุ']);
  สร้างชีต('ข้อมูลพนักงาน', ['รหัสพนักงาน','ชื่อ-นามสกุล','ตำแหน่ง','เงินเดือน','วันที่เริ่มงาน','เบอร์โทร','ที่อยู่','เลขบัญชี','สถานะ','หมายเหตุ']);
  สร้างชีต('ข้อมูลบริษัท', ['รหัสบริษัท','ชื่อบริษัท','เลขผู้เสียภาษี','ที่อยู่','ผู้ติดต่อ','เบอร์โทร','อีเมล','เงื่อนไขการชำระ','สถานะ','หมายเหตุ']);

  // ๒. ระบบการบัญชีและการเงิน
  สร้างชีต('รายรับห้องพักรายวัน', ['วันที่','รหัสการจอง','รหัสห้อง','รหัสลูกค้า','ราคาห้อง','ค่าบริการเพิ่มเติม','ยอดรวม','วิธีชำระ','สถานะ','หมายเหตุ']);
  สร้างชีต('รายรับห้องพักรายเดือน', ['เดือน/ปี','รหัสห้อง','รหัสผู้เช่า','ค่าเช่าพื้นฐาน','มิเตอร์ไฟเก่า','มิเตอร์ไฟใหม่','หน่วยใช้ไฟ','ค่าไฟ','มิเตอร์น้ำเก่า','มิเตอร์น้ำใหม่','หน่วยใช้น้ำ','ค่าน้ำ','ค่าบริการอื่น','ยอดรวม','สถานะชำระ']);
  สร้างชีต('รายรับบ้านเช่า', ['เดือน/ปี','รหัสบ้าน','รหัสผู้เช่า','ค่าเช่า','วันที่ชำระ','วิธีชำระ','สถานะ','หมายเหตุ']);
  สร้างชีต('รายจ่ายประจำวัน', ['วันที่','รหัสรายจ่าย','หมวดรายจ่าย','รายละเอียด','จำนวนเงิน','ผู้อนุมัติ','ใบเสร็จ/บิล','สถานะ','หมายเหตุ']);
  สร้างชีต('รายจ่ายประจำเดือน', ['เดือน/ปี','ประเภทรายจ่าย','รายละเอียด','จำนวนเงิน','วันที่จ่าย','ผู้รับเงิน','เอกสารอ้างอิง','สถานะ','หมายเหตุ']);

  // ๓. ข้อมูลองค์กรและประวัติ
  สร้างชีต('ข้อมูลห้องพัก', ['รหัสห้อง','ประเภทห้อง','ราคารายวัน','ราคารายเดือน','ขนาดห้อง','สิ่งอำนวยความสะดวก','สถานะห้อง','ผู้เช่าปัจจุบัน','วันที่เข้าพัก','หมายเหตุ']);
  สร้างชีต('ข้อมูลบ้านเช่า', ['รหัสบ้าน','ที่อยู่','ขนาด','ราคาเช่า','ผู้เช่าปัจจุบัน','วันที่เริ่มเช่า','วันที่สิ้นสุดสัญญา','สถานะ','หมายเหตุ']);
  สร้างชีต('ข้อมูลการจดทะเบียน', ['ประเภทใบอนุญาต','เลขที่ใบอนุญาต','วันที่ออก','วันหมดอายุ','หน่วยงานออก','สถานะ','ไฟล์เอกสาร','หมายเหตุ']);
  สร้างชีต('ข้อมูลองค์กร', ['ชื่อธุรกิจ','เลขผู้เสียภาษี','ที่อยู่','เบอร์โทร','อีเมล','เว็บไซต์','ลิงก์แผนที่','ประวัติการก่อตั้ง','ผู้บริหาร','หมายเหตุ']);

  // ๔. ระบบเชื่อมโยงข้อมูล
  สร้างชีต('ตารางรหัสหลัก', ['ประเภทรหัส','รหัส','คำอธิบาย','ตารางที่เชื่อมโยง','สถานะใช้งาน','วันที่สร้าง','ผู้สร้าง','วันที่แก้ไขล่าสุด','หมายเหตุ']);
  สร้างชีต('การเชื่อมโยงข้อมูล', ['รหัสหลัก','รหัสเชื่อมโยง','ประเภทความสัมพันธ์','ตารางต้นทาง','ตารางปลายทาง','สถานะ','วันที่เชื่อมโยง','หมายเหตุ']);

  // ๕. การจัดการงานเอกสาร
  สร้างชีต('ใบเสร็จค่าห้องพัก', ['เลขที่ใบเสร็จ','วันที่ออก','รหัสลูกค้า','รหัสห้อง','รายการ','จำนวนเงิน','ภาษี','ยอดรวม','ผู้ออกใบเสร็จ','ไฟล์พีดีเอฟ']);
  สร้างชีต('ใบแจ้งหนี้รายเดือน', ['เลขที่ใบแจ้งหนี้','เดือน/ปี','รหัสผู้เช่า','รหัสห้อง/บ้าน','รายการค่าใช้จ่าย','ยอดรวม','วันครบกำหนด','สถานะ','ไฟล์พีดีเอฟ']);
  สร้างชีต('สัญญาเช่า', ['เลขที่สัญญา','ประเภทสัญญา','รหัสผู้เช่า','รหัสห้อง/บ้าน','วันที่เริ่มสัญญา','วันที่สิ้นสุด','ค่าเช่า','เงินประกัน','สถานะ','ไฟล์พีดีเอฟ']);
  สร้างชีต('เอกสารเทศบาล', ['ประเภทเอกสาร','เดือน/ปี','จำนวนผู้เข้าพัก','วันที่ส่ง','หน่วยงานรับ','สถานะ','ไฟล์เอกสาร','หมายเหตุ']);

  // ๖. การติดตามงานประจำเดือน
  สร้างชีต('การชำระค่าสาธารณูปโภค', ['เดือน/ปี','ประเภท','หมายเลขผู้ใช้','หน่วยใช้','จำนวนเงิน','วันครบกำหนด','วันที่ชำระ','สถานะ','ใบเสร็จ','หมายเหตุ']);
  สร้างชีต('การเก็บค่าเช่าประจำเดือน', ['เดือน/ปี','รหัสห้อง/บ้าน','รหัสผู้เช่า','ยอดค่าเช่า','วันที่เก็บ','จำนวนที่เก็บได้','คงเหลือ','สถานะ','หมายเหตุ']);

  // ๗. บันทึกประวัติการทำงาน
  สร้างชีต('ประวัติการทำงานรายเดือน', ['เดือน/ปี','กิจกรรม','รายละเอียด','ผู้รับผิดชอบ','สถานะ','วันที่เริ่ม','วันที่เสร็จ','ผลลัพธ์','หมายเหตุ']);

  // ๘. โฟลเดอร์เก็บข้อมูลรูปภาพ
  สร้างชีต('ไฟล์สลิปการชำระ', ['รหัสไฟล์','วันที่','ประเภท','รหัสอ้างอิง','ชื่อไฟล์','โฟลเดอร์','ขนาดไฟล์','ผู้อัพโหลด','สถานะ','ลิงก์']);
  สร้างชีต('ไฟล์บิลค่าใช้จ่าย', ['รหัสไฟล์','วันที่','ประเภทค่าใช้จ่าย','รหัสรายจ่าย','ชื่อไฟล์','โฟลเดอร์','จำนวนเงิน','ผู้อัพโหลด','สถานะ','ลิงก์']);

  // ๙. ระบบควบคุมกลาง
  const ควบคุม = สร้างชีต('ระบบควบคุมกลาง', ['ชื่อชีต','สถานะ','จำนวนข้อมูล','อัพเดทล่าสุด','ผู้รับผิดชอบ','การเชื่อมโยง','สูตรนำเข้า','หมายเหตุ']);

  // เพิ่มข้อมูลตัวอย่าง
  const ชีตทั้งหมด = ss.getSheets();
  ชีตทั้งหมด.forEach(sheet => {
    if (sheet.getName() !== 'ระบบควบคุมกลาง' && sheet.getName() !== 'Sheet1') {
      ควบคุม.appendRow([sheet.getName(), 'พร้อมใช้งาน', 0, new Date(), 'ผู้ดูแลระบบ', 'เชื่อมโยงแล้ว', `=IMPORTRANGE("${ss.getId()}", "${sheet.getName()}!A:Z")`, 'สร้างเรียบร้อย']);
    }
  });

  // ลบชีตเริ่มต้น
  ss.deleteSheet(ss.getSheetByName('Sheet1'));
  
  return ss.getUrl();
}

function สร้างIDอัตโนมัติ(ประเภท) {
  const วันนี้ = new Date();
  const ปี = วันนี้.getFullYear().toString().slice(-2);
  const เดือน = (วันนี้.getMonth() + 1).toString().padStart(2, '0');
  const วัน = วันนี้.getDate().toString().padStart(2, '0');
  
  const รูปแบบID = {
    'ลูกค้า': `CUS${ปี}${เดือน}${วัน}`,
    'พนักงาน': `EMP${ปี}${เดือน}${วัน}`,
    'ห้องพัก': `RM${ปี}${เดือน}${วัน}`,
    'การจอง': `BK${ปี}${เดือน}${วัน}`,
    'ใบเสร็จ': `RC${ปี}${เดือน}${วัน}`,
    'ใบแจ้งหนี้': `INV${ปี}${เดือน}${วัน}`,
    'สัญญา': `CT${ปี}${เดือน}${วัน}`,
    'รายจ่าย': `EX${ปี}${เดือน}${วัน}`
  };
  
  const baseID = รูปแบบID[ประเภท] || `GEN${ปี}${เดือน}${วัน}`;
  const เลขลำดับ = Math.floor(Math.random() * 900) + 100;
  
  return `${baseID}${เลขลำดับ}`;
}

function คำนวณค่าไฟน้ำ(มิเตอร์เก่า, มิเตอร์ใหม่, ประเภท) {
  const หน่วยใช้ = มิเตอร์ใหม่ - มิเตอร์เก่า;
  
  if (ประเภท === 'ไฟ') {
    if (หน่วยใช้ <= 150) return หน่วยใช้ * 3.27;
    if (หน่วยใช้ <= 400) return 150 * 3.27 + (หน่วยใช้ - 150) * 4.22;
    return 150 * 3.27 + 250 * 4.22 + (หน่วยใช้ - 400) * 4.42;
  } else {
    if (หน่วยใช้ <= 8) return หน่วยใช้ * 8.50;
    if (หน่วยใช้ <= 20) return 8 * 8.50 + (หน่วยใช้ - 8) * 9.50;
    if (หน่วยใช้ <= 30) return 8 * 8.50 + 12 * 9.50 + (หน่วยใช้ - 20) * 10.50;
    return 8 * 8.50 + 12 * 9.50 + 10 * 10.50 + (หน่วยใช้ - 30) * 11.50;
  }
}

function doPost(e) {
  try {
    const ข้อมูล = JSON.parse(e.postData.contents);
    const การกระทำ = ข้อมูล.การกระทำ;
    
    switch (การกระทำ) {
      case 'สร้างระบบ':
        const url = สร้างระบบจัดการโรงแรมครบวงจร();
        return ContentService.createTextOutput(JSON.stringify({
          สำเร็จ: true,
          ข้อความ: 'สร้างระบบจัดการโรงแรมเรียบร้อย',
          URL: url
        })).setMimeType(ContentService.MimeType.JSON);
        
      case 'สร้างID':
        const ID = สร้างIDอัตโนมัติ(ข้อมูล.ประเภท);
        return ContentService.createTextOutput(JSON.stringify({
          สำเร็จ: true,
          ID: ID
        })).setMimeType(ContentService.MimeType.JSON);
        
      case 'คำนวณค่าสาธารณูปโภค':
        const ค่าใช้จ่าย = คำนวณค่าไฟน้ำ(ข้อมูล.มิเตอร์เก่า, ข้อมูล.มิเตอร์ใหม่, ข้อมูล.ประเภท);
        return ContentService.createTextOutput(JSON.stringify({
          สำเร็จ: true,
          หน่วยใช้: ข้อมูล.มิเตอร์ใหม่ - ข้อมูล.มิเตอร์เก่า,
          ค่าใช้จ่าย: Math.round(ค่าใช้จ่าย * 100) / 100
        })).setMimeType(ContentService.MimeType.JSON);
        
      default:
        return ContentService.createTextOutput(JSON.stringify({
          สำเร็จ: false,
          ข้อความ: 'ไม่รู้จักคำสั่งนี้'
        })).setMimeType(ContentService.MimeType.JSON);
    }
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      สำเร็จ: false,
      ข้อผิดพลาด: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
